<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GTâ€‘R R34 Smart Diagnosis</title>
<style>
body{font-family:Arial,sans-serif;background:#0b0b0b;color:#fff;margin:0;padding:0;}
header{background:#e21b23;padding:18px;text-align:center;font-size:24px;font-weight:bold;}
.container{max-width:900px;margin:30px auto;padding:20px;background:#111;border-radius:12px;box-shadow:0 0 15px rgba(226,27,35,0.5);}
.tabs{display:flex;margin-bottom:15px;}
.tab{flex:1;padding:12px;text-align:center;background:#222;cursor:pointer;border-radius:8px 8px 0 0;margin-right:2px;}
.tab.active{background:#e21b23;font-weight:bold;}
.tab-content{display:none;background:#1a1a1a;padding:15px;border-radius:0 0 8px 8px;}
input,select,button{width:100%;padding:12px;margin:8px 0;border-radius:8px;border:none;font-size:16px;}
input,select{background:#222;color:#fff;}
button{background:#e21b23;color:#fff;cursor:pointer;transition:0.3s;}
button:hover{background:#ff2a33;}
.answer{margin-top:20px;padding:15px;background:#111;border-left:5px solid #e21b23;border-radius:8px;}
.title{font-size:20px;font-weight:bold;color:#e21b23;}
.confidence{font-size:14px;margin-top:6px;font-weight:bold;padding:4px 8px;border-radius:4px;display:inline-block;}
.steps li{margin-bottom:6px;}
</style>
</head>
<body>
<header>ðŸ”§ GTâ€‘R R34 Smart Diagnosis</header>
<div class="container">
<div class="tabs">
<div class="tab" onclick="openTab(event,'Search')">Cari Gejala</div>
<div class="tab" onclick="openTab(event,'Category')">Pilih Kategori</div>
</div>

<div id="Search" class="tab-content">
<label>Ketik gejala masalah:</label>
<input type="text" id="searchInput" placeholder="contoh: overheating atau suara grinding saat ganti gigi">
<button onclick="searchProblem()">Cari</button>
<div id="searchResult"></div>
</div>

<div id="Category" class="tab-content">
<label>Pilih kategori masalah:</label>
<select id="categorySelect">
<option value="">-- Pilih Masalah --</option>
</select>
<button onclick="showCategory()">Cari</button>
<div id="categoryResult"></div>
</div>
</div>

<script>
// -------------------------
// DATASET
// -------------------------
const dataset = [
    {title:"Overheating / Sistem Pendingin RB26", problem:"Mesin cepat panas, suhu air naik terutama saat boost tinggi atau lalu lintas padat.", indications:["Level coolant rendah atau campuran tidak tepat","Kipas pendingin tidak menyala","Thermostat macet atau water pump lemah","Radiator/intercooler tersumbat"], solution:"Periksa level & campuran coolant, radiator/intercooler, thermostat, water pump, fan & sensor suhu.", steps:["Cek level coolant dan campurannya; tambah/ganti jika rendah atau kotor","Periksa radiator cap dan kondisi radiator","Periksa fan, relay, dan sensor suhu","Cek thermostat dan water pump; ganti jika rusak","Flush radiator/intercooler jika tersumbat","Bleed sistem pendingin untuk buang udara","Cek head gasket jika overheating berulang"]},
    {title:"Turbo Lag / Boost Leak", problem:"Respon turbo lambat, kehilangan boost, muncul suara 'hissing'.", indications:["Suara 'hissing' saat akselerasi boost","Boost gauge drop tiba-tiba","Coupler intercooler kendor atau berbalon"], solution:"Periksa semua coupler intercooler & turbo, hose vakum, clamp, intercooler core.", steps:["Dengarkan suara 'hissing' saat boost","Periksa coupler intercooler & turbo; pastikan kencang","Periksa hose vakum dan vacuum line; ganti yang retak","Pressure test intake/intercooler","Cek kondisi turbo, shaft play, oil supply"]},
    {title:"Ignition Coil / Misfire", problem:"Idle tidak stabil, backfire, tenaga drop.", indications:["Pemeriksaan busi menunjukkan aus atau kotor","Engine scan error P0300-P0306","Tenaga drop saat akselerasi"], solution:"Ganti coil pack yang lemah, ganti busi, cek wiring & ground.", steps:["Cek busi: warna dan kondisi electrode","Periksa coil pack: ukur resistansi","Periksa wiring & ground coil","Ganti coil dan busi jika perlu","Tes idle dan performa setelah penggantian"]},
    {title:"Fuel Pump Lemah / Tekanan Tidak Stabil", problem:"Tenaga drop saat high boost, stuttering.", indications:["Tekanan bahan bakar rendah saat high load","Relay fuel pump panas atau bau terbakar","Filter bensin tersumbat"], solution:"Periksa tekanan bahan bakar, relay, filter, ganti fuel pump jika lemah.", steps:["Ukur tekanan bahan bakar saat idle & full load","Periksa relay fuel pump & fuse","Cek filter bensin, bersihkan/ganti jika tersumbat","Ganti fuel pump jika tekanan drop saat high boost"]},
    {title:"Gearbox Crunch / Synchro Rusak", problem:"Suara grinding saat masuk gigi, susah masuk gigi 2/3.", indications:["Grinding saat shifting ke gigi 2 atau 3","Oli gearbox sudah lama atau gelap","Perpindahan gigi terasa kasar"], solution:"Periksa oli gearbox, ganti oli, rebuild transmisi jika synchro aus.", steps:["Cek level & jenis oli gearbox","Ganti oli sesuai rekomendasi","Masuk gigi pelan-pelan, dengarkan grinding","Jika synchro aus, rebuild transmisi"]},
    {title:"Clutch Slip", problem:"RPM naik tapi mobil tidak maju sesuai, terutama saat high boost.", indications:["Pedal kopling lebih lembek atau travel bertambah","RPM naik tapi akselerasi kurang","Hydraulic master/slave bermasalah"], solution:"Periksa wear plate, pressure plate, flywheel, hydraulic system; ganti kopling jika aus.", steps:["Tes akselerasi, perhatikan RPM vs akselerasi","Cek hydraulic master/slave cylinder","Periksa wear plate, pressure plate, flywheel","Ganti kopling sesuai stage mesin","Bleed sistem hidrolik jika hydraulic slip"]},
    {title:"Vacuum Leak / Idle Tidak Stabil", problem:"Idle drop, suara hiss, boost tidak stabil.", indications:["Suara hiss di throttle body saat idle","Hose vakum atau coupler intake retak/kendor","Boost tidak stabil"], solution:"Periksa semua hose vakum, gasket, lakukan smoke test.", steps:["Dengarkan suara hiss saat idle","Periksa hose vakum, gasket, coupler","Lakukan smoke test jika perlu","Ganti gasket/hose bocor","Cek kembali idle dan boost response"]},
    {title:"Electrical / ECU & Wiring Faults", problem:"MFD mati, immobiliser tidak bekerja, ECU error, panel instrumen rusak.", indications:["Fuse atau relay terbakar","Ground bodi mesin korosi/lepas","Scanner menunjukkan error ECU"], solution:"Periksa sambungan ground & kabel baterai, fuse & relay, modul ECU/immobiliser, ganti panel instrumen jika rusak.", steps:["Periksa terminal baterai dan bersihkan kontak","Cek fuse dan relay terkait ECU","Periksa kabel ground bodi mesin & rangka","Gunakan scanner diagnostic untuk membaca error ECU","Ganti panel instrumen atau MFD jika rusak"]},
    // Tambahkan semua dataset lainnya di sini...
];

// -------------------------
// UTILITIES
// -------------------------
function preprocess(text){
    text = text.toLowerCase().trim();
    text = text.replace(/[^a-z0-9\s]/g,' ');
    const words = text.split(/\s+/);
    const stopwords = ["dan","yang","pada","saat","karena","itu","di","ke","dengan","atau","adalah","untuk","dari","ada","saya","kamu","mobil"];
    return words.filter(w => w.length>1 && !stopwords.includes(w));
}
function toFreqVector(tokens){
    const freq={};
    tokens.forEach(t => freq[t]=(freq[t]||0)+1);
    return freq;
}
function cosineSimilarity(tokensA,tokensB){
    if(tokensA.length===0 || tokensB.length===0) return 0;
    const vecA = toFreqVector(tokensA);
    const vecB = toFreqVector(tokensB);
    let dot=0, normA=0, normB=0;
    Object.keys(vecA).forEach(term=>{
        const countA=vecA[term];
        const countB=vecB[term]||0;
        dot += countA*countB;
        normA += countA*countA;
    });
    Object.values(vecB).forEach(countB => normB += countB*countB);
    if(normA===0||normB===0) return 0;
    return dot / (Math.sqrt(normA)*Math.sqrt(normB));
}
function confidenceColor(score){
    if(score>0.7) return "#4CAF50";
    if(score>0.4) return "#FFC107";
    return "#F44336";
}
function formatAnswer(item, confidence=null){
    let html = `<div class="answer"><div class="title">${item.title}</div>`;
    if(confidence!==null) html += `<div class="confidence" style="background:${confidenceColor(confidence)};">Confidence: ${confidence.toFixed(3)}</div>`;
    if(item.indications) html += `<p><strong>Indikasi Awal:</strong><br>${item.indications.join('<br>')}</p>`;
    if(item.problem) html += `<p><strong>Deskripsi:</strong><br>${item.problem}</p>`;
    if(item.solution) html += `<p><strong>Solusi:</strong><br>${item.solution}</p>`;
    if(item.steps){
        html += `<p><strong>Stepâ€‘byâ€‘Step:</strong></p><ol class="steps">`;
        item.steps.forEach(s=> html += `<li>${s}</li>`);
        html += `</ol>`;
    }
    html += `</div>`;
    return html;
}

// -------------------------
// TABS
// -------------------------
function openTab(evt, tabName){
    const tabcontent = document.getElementsByClassName("tab-content");
    for(let i=0;i<tabcontent.length;i++) tabcontent[i].style.display="none";
    const tablinks = document.getElementsByClassName("tab");
    for(let i=0;i<tablinks.length;i++) tablinks[i].className = tablinks[i].className.replace(" active","");
    document.getElementById(tabName).style.display="block";
    evt.currentTarget.className += " active";
}
window.onload = function(){ 
    document.getElementsByClassName("tab")[0].click();
    // isi dropdown kategori
    const categorySelect = document.getElementById("categorySelect");
    dataset.forEach((item,i)=>{
        const opt = document.createElement("option");
        opt.value = i;
        opt.textContent = item.title;
        categorySelect.appendChild(opt);
    });
};

// -------------------------
// SEARCH
// -------------------------
function searchProblem(){
    const query = document.getElementById("searchInput").value;
    const tokens = preprocess(query);
    let bestScore=0, bestItem=null;
    dataset.forEach(item=>{
        const itemTokens = preprocess(item.title + " " + item.problem);
        const score = cosineSimilarity(tokens, itemTokens);
        if(score>bestScore){
            bestScore=score;
            bestItem=item;
        }
    });
    const resultDiv = document.getElementById("searchResult");
    if(bestItem) resultDiv.innerHTML = formatAnswer(bestItem,bestScore);
    else resultDiv.innerHTML = '<p>Tidak ada hasil yang cocok.</p>';
}

function showCategory(){
    const index = document.getElementById("categorySelect").value;
    if(index==='') return;
    const item = dataset[index];
    document.getElementById("categoryResult").innerHTML = formatAnswer(item);
}
</script>
</body>
</html>
